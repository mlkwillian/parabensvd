<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Jogo do Carro</title>
  <style>
    body { 
      margin:0; 
      background:#111; 
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      height:100vh;
    }
    canvas { 
      background:linear-gradient(#222,#000); 
      margin-top:20px;
    }

    /* t√≠tulo e dica */
    #hud {
      text-align: center;
      color: white;
      font-family: Arial, sans-serif;
      margin-bottom: 15px;
    }
    #hud h1 {
      margin: 0;
      font-size: 2.5em;
      color: #ff4d6d;
      text-shadow: 0 0 10px #ff4d6d;
    }
    #hud p {
      margin: 5px 0 0;
      font-size: 1.2em;
      color: #ddd;
    }

    /* controles */
    #controles {
      position: fixed;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-around;
      pointer-events: none;
    }

    #controles button {
      pointer-events: all;
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      color: white;
      font-size: 2em;
      border-radius: 50%;
      width: 70px;
      height: 70px;
      box-shadow: 0 0 15px rgba(255,0,0,0.7);
      cursor: pointer;
    }

    /* efeito da mensagem final */
    .final {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      height:100vh;
      color:white;
      text-align:center;
      animation: fadeIn 2s ease forwards;
      background: transparent;
    }
    .final h1 {
      font-size:3em;
      color:#ff4d6d;
      animation:pulse 1.5s infinite;
      text-shadow:0 0 20px #ff4d6d;
    }
    .final p {
      max-width:600px;
      font-size:1.3em;
      margin-top:20px;
    }
    .final a {
      margin-top:20px;
      color:#fff;
      background:#ff4d6d;
      padding:10px 20px;
      border-radius:10px;
      text-decoration:none;
      font-weight:bold;
      box-shadow:0 0 10px #ff4d6d;
    }
    @keyframes pulse { 
      0%{transform:scale(1)} 
      50%{transform:scale(1.1)} 
      100%{transform:scale(1)} 
    }
    @keyframes fadeIn {
      from { opacity:0; transform:translateY(20px); }
      to { opacity:1; transform:translateY(0); }
    }
  </style>
</head>
<body>
  <div id="hud">
    <h1>üöó Jogo do Carro</h1>
    <p>Dica: pegue os cora√ß√µes ‚ù§Ô∏è ‚Äî cada batida conta como ponto!</p>
  </div>

  <canvas id="gameCanvas"></canvas>

  <div id="controles">
    <button id="btnEsquerda">‚¨ÖÔ∏è</button>
    <button id="btnDireita">‚û°Ô∏è</button>
  </div>

  <script>
    const canvas=document.getElementById("gameCanvas");
    const ctx=canvas.getContext("2d");
    canvas.width=500;  // largura maior
    canvas.height=700; // altura maior

    // pista (para centralizar limites)
    const trackX = 100;
    const trackW = canvas.width - 200;

    // imagens
    const carroImg=new Image();
    carroImg.src="carro.png";

    const coracaoImg=new Image();
    coracaoImg.src="coracao.webp";

    // carro centralizado na pista
    let carro={x: trackX + trackW/2 - 25, y:600, w:50, h:90, speed:6};
    let esquerda=false,direita=false;
    let obstaculos=[];
    let pontos=0;              // agora representa colis√µes (hits)
    let gameOver=false;
    let jogoAtivo=false;

    const heartSize = 50;
    const heartSpeed = 4;
    const spawnIntervalFrames = 180; // ~3s
    const targetHits = 23; // vit√≥ria ao pegar 23 cora√ß√µes

    let frameCount = 0;

    // controles
    const btnEsquerda = document.getElementById("btnEsquerda");
    const btnDireita = document.getElementById("btnDireita");

    // mobile (prevent default para evitar scroll)
    btnEsquerda.addEventListener("touchstart", (e)=>{ e.preventDefault(); esquerda=true; });
    btnEsquerda.addEventListener("touchend", (e)=>{ e.preventDefault(); esquerda=false; });
    btnDireita.addEventListener("touchstart", (e)=>{ e.preventDefault(); direita=true; });
    btnDireita.addEventListener("touchend", (e)=>{ e.preventDefault(); direita=false; });

    // desktop (mousedown segura, mouseup solta)
    btnEsquerda.addEventListener("mousedown", ()=>esquerda=true);
    btnEsquerda.addEventListener("mouseup", ()=>esquerda=false);
    btnDireita.addEventListener("mousedown", ()=>direita=true);
    btnDireita.addEventListener("mouseup", ()=>direita=false);

    // garante que soltar fora tamb√©m pare o movimento
    document.addEventListener("mouseup", ()=>{ esquerda=false; direita=false; });
    document.addEventListener("touchcancel", ()=>{ esquerda=false; direita=false; });

    document.addEventListener("keydown",e=>{
      if(e.key==="ArrowLeft") esquerda=true;
      if(e.key==="ArrowRight") direita=true;
    });
    document.addEventListener("keyup",e=>{
      if(e.key==="ArrowLeft") esquerda=false;
      if(e.key==="ArrowRight") direita=false;
    });

    function criarObstaculo(){
      let tamanho = heartSize;
      let x = trackX + Math.random() * (trackW - tamanho);
      obstaculos.push({x, y: -tamanho, w: tamanho, h: tamanho});
    }

    function atualizar(){
      if(gameOver) return;

      // mover carro dentro da pista
      if(esquerda && carro.x > trackX) carro.x -= carro.speed;
      if(direita && carro.x < trackX + trackW - carro.w) carro.x += carro.speed;

      // mover cora√ß√µes e checar colis√µes (iterar de tr√°s para frente para remover com seguran√ßa)
      for(let i = obstaculos.length - 1; i >= 0; i--){
        const o = obstaculos[i];
        o.y += heartSpeed;

        // colis√£o simples AABB
        if(carro.x < o.x + o.w &&
           carro.x + carro.w > o.x &&
           carro.y < o.y + o.h &&
           carro.y + carro.h > o.y) {
             // colis√£o: conta ponto e remove o cora√ß√£o
             pontos++;
             obstaculos.splice(i,1);

             // final se bateu o suficiente
             if(pontos >= targetHits){
               gameOver = true;
               setTimeout(surpresaFinal, 800);
               return;
             }
             continue; // passa pro pr√≥ximo obst√°culo
        }

        // remove cora√ß√µes que saem do canvas
        if(o.y > canvas.height + 50){
          obstaculos.splice(i,1);
        }
      }

      // controle de spawn por frames (inicia s√≥ depois de jogoAtivo true)
      frameCount++;
      if(jogoAtivo && frameCount % spawnIntervalFrames === 0){
        criarObstaculo();
      }
    }

    function desenhar(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // pista centralizada
      ctx.fillStyle="#444";
      ctx.fillRect(trackX,0,trackW,canvas.height);

      // linhas da pista (no centro visual)
      ctx.fillStyle="#fff";
      for(let i=0;i<canvas.height;i+=40){
        ctx.fillRect(canvas.width/2-5,i,10,20);
      }

      // carro
      if (carroImg.complete) {
        ctx.drawImage(carroImg,carro.x,carro.y,carro.w,carro.h);
      } else {
        // fallback se imagem n√£o carregou
        ctx.fillStyle = "#0af";
        ctx.fillRect(carro.x, carro.y, carro.w, carro.h);
      }

      // cora√ß√µes
      for(let o of obstaculos){
        if (coracaoImg.complete) {
          ctx.drawImage(coracaoImg,o.x,o.y,o.w,o.h);
        } else {
          ctx.fillStyle = "#f55";
          ctx.fillRect(o.x,o.y,o.w,o.h);
        }
      }

      // HUD: pontos
      ctx.fillStyle="yellow";
      ctx.font="20px Arial";
      ctx.fillText("Pontos: "+pontos,10,30);
      ctx.fillText(`Meta: ${targetHits}`,10,55);
    }

    function loop(){
      atualizar();
      desenhar();
      if(!gameOver) requestAnimationFrame(loop);
    }

    // inicia o loop (cora√ß√µes s√≥ ap√≥s 5s)
    loop();
    setTimeout(()=>{ jogoAtivo=true; },3000);

    // surpresa final
    function surpresaFinal(){
      document.body.innerHTML=`
        <div class="final">
          <h1>üíñ Surpresa Final üíñ</h1>
          <p>
            Voc√™ venceu pegou todos os ${targetHits} cora√ß√µes!  
            <br><br>
            Jana, voc√™ √© incr√≠vel. Esse jogo foi s√≥ um jeitinho bobo de te mostrar o quanto eu penso em voc√™.  
            <br><br>
            Obrigado por existir, feliz anivers√°rio! üéâüíñ
          </p>
          <a href="index.html">Voltar para o in√≠cio</a>
        </div>
      `;
    }
  </script>
</body>
</html>
